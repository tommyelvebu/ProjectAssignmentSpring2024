{% extends "template.html" %}

{% block title %}Questionnaire{% endblock %}

{% block main %}
<div class="container my-5">
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="alert alert-{{ category }}">
        {{ message }}
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}

    <!-- Div 1: Student, Teacher, and Course selection -->
    <div id="div1" class="form-container">
        <h2 class="mb-4">Student Information</h2>
        <form id="form1">
            <div class="mb-3">
                <label for="student_id" class="form-label label-style">Student's Name</label>
                <select class="form-select custom-select" id="student_id" name="student_id" required>
                    <option value="">Select a student</option>
                    {% for student in students %}
                    <option value="{{ student.student_id }}">{{ student.student_name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="mb-3">
                <label for="teacher_id" class="form-label">Homeroom Teacher</label>
                <select class="form-select custom-select" id="teacher_id" name="teacher_id" required>
                    <option value="">Select a teacher</option>
                    {% for teacher in teachers %}
                    <option value="{{ teacher.teacher_id }}">{{ teacher.teacher_name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="mb-3">
                <label for="course_id" class="form-label">Favorite Course</label>
                <select class="form-select custom-select" id="course_id" name="course_id" required>
                    <option value="">Select a course</option>
                    {% for course in courses %}
                    <option value="{{ course.course_id }}">{{ course.course_name }}</option>
                    {% endfor %}
                </select>
            </div>
            <button type="button" class="btn btn-primary" onclick="showDiv('div2')">Next</button>
        </form>
    </div>

    <!-- Div 2: Preferred student 1 -->
    <div id="div2" class="form-container" style="display:none;">
        <h2 class="mb-4">Select Preferred Student 1</h2>
        <form id="form2">
            <!-- Dynamic content based on earlier selection -->
            <button type="button" class="btn btn-primary" onclick="showDiv('div3')">Next</button>
        </form>
    </div>

    <!-- Div 3: Preferred student 2 -->
    <div id="div3" class="form-container" style="display:none;">
        <h2 class="mb-4">Select Preferred Student 2</h2>
        <form id="form3">
            <!-- Dynamic content based on earlier selection -->
            <button type="button" class="btn btn-primary" onclick="showDiv('div4')">Next</button>
        </form>
    </div>

    <!-- Div 4: Preferred student 3 -->
    <div id="div4" class="form-container" style="display:none;">
        <h2 class="mb-4">Select Preferred Student 3</h2>
        <form id="form4">
            <!-- Dynamic content based on earlier selection -->
            <button type="button" class="btn btn-primary" onclick="submitAllForms()">Submit</button>
        </form>
    </div>
</div>

<script>
    function showDiv(divId) {
        // Hide all divs
        document.getElementById('div1').style.display = 'none';
        document.getElementById('div2').style.display = 'none';
        document.getElementById('div3').style.display = 'none';
        document.getElementById('div4').style.display = 'none';

        // Show the requested div
        document.getElementById(divId).style.display = 'block';
    }

    function submitAllForms() {
    // Create an object to store all form data
    var formData = {
        student_id: document.getElementById('student_id').value,
        teacher_id: document.getElementById('teacher_id').value,
        course_id: document.getElementById('course_id').value,
        // Add other form fields as needed
    };

    // Send the data using Fetch API
    fetch('/your_submission_route', {
        method: 'POST', // or 'PUT'
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData),
    })
    .then(response => response.json())
    .then(data => {
        console.log('Success:', data);
        window.location.href = '/thank_you'; // Redirect to thank you page on success
    })
    .catch((error) => {
        console.error('Error:', error);
    });
}

    </script>
</div>
{% endblock %}

